# Task 003: Audio Routing

## Frontmatter
```yaml
name: "Audio Routing"
status: "not_started"
created: "2025-09-08T20:08:17Z"
updated: 2025-09-08T20:23:58Z
github: https://github.com/FackJox/wibblywobblaz/issues/8
depends_on: ["001", "002"]
parallel: false
conflicts_with: []
```

## Overview
Implement professional audio routing system with crossfader, 3-band EQ per channel, channel mixing logic, and proper gain staging for seamless DJ mixing capabilities.

## Acceptance Criteria
- [ ] Crossfader functionality with smooth audio blending between decks
- [ ] 3-band EQ (High, Mid, Low) per deck with kill switches
- [ ] Channel gain control with proper headroom management
- [ ] Pre-fader listening (PFL/CUE) system for headphone monitoring
- [ ] Master output level control with limiter
- [ ] Audio routing matrix supporting multiple output scenarios
- [ ] Real-time audio processing without noticeable latency
- [ ] Smooth parameter changes without audio artifacts (clicks/pops)
- [ ] EQ frequency response matches professional DJ mixers

## Technical Requirements
- Web Audio API GainNode and BiquadFilterNode usage
- Real-time audio graph management
- Low-latency audio processing (< 20ms total)
- Proper audio buffer management
- Crossfader curve implementation (linear, constant power, etc.)
- EQ frequency bands: High (10kHz), Mid (1kHz), Low (100Hz)

## Implementation Details
- Create `AudioRouter` class for routing management
- Implement `ChannelStrip` class for per-deck audio processing
- Build `Crossfader` class with multiple curve types
- Create `EQProcessor` class for 3-band equalization
- Implement `MasterSection` class for final output processing
- Add `CueSystem` class for headphone monitoring
- Integrate with AudioManager from Task 001

## Audio Signal Flow
```
Deck A Audio → Channel A (Gain → EQ → PFL) → Crossfader A Input
                                              ↓
                                         Master Mix → Master Gain → Output
                                              ↑
Deck B Audio → Channel B (Gain → EQ → PFL) → Crossfader B Input
```

## UI Integration
- Crossfader using existing Slider component with custom styling
- EQ knobs using Slider components with center detent
- Gain controls with proper scaling and visual feedback
- PFL buttons using existing Button components with active states
- Master level meter using Progress component

## Performance Considerations
- Minimize audio graph changes during playback
- Use efficient filter implementations
- Implement smooth parameter transitions
- Optimize for mobile device CPU limitations

## Effort Estimate
- Size: L (Large)
- Hours: 24-30 hours
- Complexity: High (Complex audio processing and routing)

## Dependencies
- Task 001 (Audio Foundation) - requires AudioManager and basic playback
- Task 002 (Dual Deck UI) - requires deck components for control integration

## Notes
- Audio processing must be robust and glitch-free
- Consider future expansion for effects sends and returns
- Plan for external audio interface support (Web MIDI API)
- Research professional DJ mixer routing for authentic behavior
- Test extensively on different devices for performance optimization
